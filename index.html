<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡åº†å¸‚ç¬¬66ä¸­å­¦æ ¡2025çº§1ç­æ¯•ä¸šçºªå¿µ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“</text></svg>">
    <!-- LeanCloud SDK -->
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.13.2/dist/av-min.js"></script>
</head>
<body>

    <!-- å¯æ‹–åŠ¨çš„ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
    <div class="theme-switch" id="themeSwitch">
        <button id="themeButton">
            <i class="fas fa-moon"></i>
            <span>å¤œé—´æ¨¡å¼</span>
        </button>
    </div>

    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-graduation-cap"></i>
                <span>66ä¸­2025çº§1ç­</span>
            </div>
            <div class="nav-links">
                <a href="#" class="active">é¦–é¡µ</a>
                <a href="sxd.html">ç«™é•¿ä»‹ç»</a>
                <a href="#gallery">ç…§ç‰‡å¢™</a>
                <a href="#roster">é€šè®¯å½•</a>
                <a href="#timeline">æ—¶å…‰è½´</a>
                <a href="#comments">æ¯•ä¸šæ„Ÿè¨€</a>
                <a href="login.html" id="auth-btn">ç™»å½•/æ³¨å†Œ</a>
                <a href="admin.html" id="adminLink" style="display:none;">ç®¡ç†åå°</a>
                <a href="https://lz.qaiu.top/parser?url=https://share.feijipan.com/s/8WMFyDSt">æ¯•ä¸šç›¸å†Œç”µå­ç‰ˆä¸‹è½½</a>
            </div>
            <button class="nav-toggle" id="navToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="container">
        <!-- å¤´éƒ¨åŒºåŸŸ -->
        <header class="glass-container">
            <div class="school-logo">
                <i class="fas fa-school"></i>
            </div>
            <h1>æ¯•ä¸šçºªå¿µå†Œ</h1>
            <div class="subtitle">é’æ˜¥ä¸æ•£åœº Â· æ¢¦æƒ³å†èµ·èˆª</div>
            <div class="subtitle">"åœ°çƒä¸å€’å¡Œæˆ‘ä»¬å°±ä¸åœæ­¢ç»´æŠ¤"<div>
            <div class="class-info">
                <i class="fas fa-map-marker-alt"></i> é‡åº†å¸‚ç¬¬66ä¸­å­¦æ ¡ Â· 
                <i class="fas fa-graduation-cap"></i> 2025çº§1ç­
            </div>
        </header>

        <!-- è§†é¢‘åŒºåŸŸ -->
        <section class="video-section glass-container">
            <h2 class="section-title">æˆ‘ä»¬çš„æ¯•ä¸šè§†é¢‘(ä¸ºäº†åˆæ³•æˆ‘ä»¬è¿›è¡Œäº†æ›¿æ¢)</h2>
            <div class="video-container">
                <video id="graduationVideo" controls poster="assets/images/video-poster.jpg">
                    <source src="https://lz.qaiu.top/parser?url=https://share.feijipan.com/s/nYMT3t29" type="video/mp4">
                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
                </video>
            </div>
        </section>

        <!-- ç…§ç‰‡å¢™ -->
        <section class="gallery-section glass-container" id="gallery">
            <h2 class="section-title">ç­çº§è®°å¿†</h2>
            <div class="photo-grid">
                <!-- ç…§ç‰‡é¡¹ä¿æŒä¸å˜ -->
            </div>
        </section>

        <!-- ç­çº§é€šè®¯å½• -->
        <section class="roster-section glass-container" id="roster">
            <h2 class="section-title">ç­çº§é€šè®¯å½•</h2>
            <div class="roster-container" id="rosterContainer">
                <!-- å­¦ç”Ÿä¿¡æ¯é€šè¿‡JavaScriptåŠ è½½ -->
            </div>
        </section>

        <!-- æ—¶é—´çº¿ -->
        <section class="timeline-section glass-container" id="timeline">
            <h2 class="section-title">åˆä¸­æ—¶å…‰è½´</h2>
            <div class="timeline">
                <!-- æ—¶é—´çº¿é¡¹ä¿æŒä¸å˜ -->
            </div>
        </section>

        <!-- æ¯•ä¸šæ„Ÿè¨€ -->
        <section class="comments-section glass-container" id="comments">
            <h2 class="section-title">æ¯•ä¸šæ„Ÿè¨€</h2>
            <div class="speech-container" id="speechContainer">
                <div class="speech-loader">
                    <i class="fas fa-spinner fa-spin"></i> åŠ è½½è¯„è®ºä¸­...
                </div>
            </div>

            <!-- è¯„è®ºè¡¨å• -->
            <div class="comment-form" id="commentForm">
                <h3>åˆ†äº«ä½ çš„æ¯•ä¸šæ„Ÿè¨€</h3>
                <textarea id="commentInput" placeholder="è¯·è¾“å…¥ä½ çš„æ¯•ä¸šæ„Ÿè¨€..." required></textarea>
                <button id="submitComment">å‘è¡¨æ„Ÿè¨€</button>
                <p class="login-prompt" id="authPrompt">è¯·å…ˆ<a href="login.html">ç™»å½•</a>åå†å‘è¡¨æ„Ÿè¨€</p>
            </div>
        </section>

        <!-- é¡µè„š -->
        <footer class="glass-container">
            <p>Â©sxd 2025 é‡åº†å¸‚ç¬¬66ä¸­å­¦æ ¡2025çº§1ç­æ¯•ä¸šçºªå¿µç½‘ç«™ ç«™é•¿è”ç³»ç”µè¯:18723143414</p>
            <a href="sxd.html">æˆ‘çš„ä¸ªäººç«™</a>
            <a href="Score/index.html">æœ€æ–°æœ€çƒ­ä¸­è€ƒæŸ¥åˆ†ç½‘ç«™</a>
            <p>äººç”Ÿæœ‰æ¢¦ Â· å„è‡ªç²¾å½©</p>
            <p><i class="fas fa-heart"></i> æ°¸è¿œçš„ä¸€ç­ <i class="fas fa-heart"></i></p>
        </footer>
    </div>

    <!-- ç™»å½•å¼¹çª— -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ç™»å½•è´¦å·</h2>
            <form id="modalLoginForm">
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" id="modalUsername" placeholder="ç”¨æˆ·å" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="modalPassword" placeholder="å¯†ç " required>
                </div>
                <button type="submit">ç™»å½•</button>
            </form>
            <p>è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ<a href="register.html">ç«‹å³æ³¨å†Œ</a></p>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script>
        // ============== LeanCloud åˆå§‹åŒ– ==============
        // æ›¿æ¢ä¸ºä½ çš„LeanCloud App IDå’ŒApp Key
        const APP_ID = 'YOUR_APP_ID';
        const APP_KEY = 'YOUR_APP_KEY';
        
        AV.init({
            appId: APP_ID,
            appKey: APP_KEY
        });

        // ============== è¯„è®ºåŠŸèƒ½å®ç° ==============
        let currentUser = null;
        
        // è·å–è¯„è®º
        async function getComments() {
            const query = new AV.Query('Comment');
            query.descending('createdAt');
            try {
                const comments = await query.find();
                return comments.map(comment => {
                    return {
                        id: comment.id,
                        author: comment.get('author'),
                        content: comment.get('content'),
                        createdAt: comment.createdAt
                    };
                });
            } catch (error) {
                console.error('è·å–è¯„è®ºå¤±è´¥:', error);
                throw error;
            }
        }

        // æ·»åŠ è¯„è®º
        async function addComment(comment) {
            const Comment = AV.Object.extend('Comment');
            const newComment = new Comment();
            
            newComment.set('author', comment.author);
            newComment.set('content', comment.content);
            
            try {
                const savedComment = await newComment.save();
                return {
                    id: savedComment.id,
                    author: savedComment.get('author'),
                    content: savedComment.get('content'),
                    createdAt: savedComment.createdAt
                };
            } catch (error) {
                console.error('æ·»åŠ è¯„è®ºå¤±è´¥:', error);
                throw error;
            }
        }

        // åˆ é™¤è¯„è®º
        async function deleteComment(commentId) {
            const comment = AV.Object.createWithoutData('Comment', commentId);
            try {
                await comment.destroy();
            } catch (error) {
                console.error('åˆ é™¤è¯„è®ºå¤±è´¥:', error);
                throw error;
            }
        }

        // ============== ç”¨æˆ·è®¤è¯åŠŸèƒ½ ==============
        // ç”¨æˆ·æ³¨å†Œ
        async function registerUser(userData) {
            const user = new AV.User();
            user.setUsername(userData.username);
            user.setPassword(userData.password);
            user.setEmail(userData.email);
            
            try {
                const newUser = await user.signUp();
                return newUser;
            } catch (error) {
                console.error('æ³¨å†Œå¤±è´¥:', error);
                throw error;
            }
        }

        // ç”¨æˆ·ç™»å½•
        async function loginUser(username, password) {
            try {
                const user = await AV.User.logIn(username, password);
                return user;
            } catch (error) {
                console.error('ç™»å½•å¤±è´¥:', error);
                throw error;
            }
        }

        // è·å–å½“å‰ç”¨æˆ·
        function getCurrentUser() {
            return AV.User.current();
        }

        // ç”¨æˆ·ç™»å‡º
        function logoutUser() {
            AV.User.logOut();
        }

        // ============== é¡µé¢åŠŸèƒ½å®ç° ==============
        document.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹åŒ–å½“å‰ç”¨æˆ·
            currentUser = getCurrentUser();
            updateAuthUI();
            
            // åŠ è½½è¯„è®º
            loadComments();
            
            // è¯„è®ºæäº¤
            const submitComment = document.getElementById('submitComment');
            if (submitComment) {
                submitComment.addEventListener('click', async (e) => {
                    e.preventDefault();
                    
                    if (!currentUser) {
                        showLoginModal();
                        return;
                    }
                    
                    const content = document.getElementById('commentInput').value.trim();
                    if (!content) {
                        alert('è¯·è¾“å…¥æ„Ÿè¨€å†…å®¹');
                        return;
                    }
                    
                    try {
                        await addComment({
                            author: currentUser.get('username'),
                            content: content
                        });
                        
                        document.getElementById('commentInput').value = '';
                        loadComments();
                        alert('æ„Ÿè¨€å·²æäº¤ï¼æ„Ÿè°¢åˆ†äº«');
                    } catch (error) {
                        console.error('æäº¤è¯„è®ºå¤±è´¥:', error);
                        alert('æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•');
                    }
                });
            }
            
            // ç™»å½•å¼¹çª—
            const loginModal = document.getElementById('loginModal');
            const modalLoginForm = document.getElementById('modalLoginForm');
            if (modalLoginForm) {
                modalLoginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const username = document.getElementById('modalUsername').value;
                    const password = document.getElementById('modalPassword').value;
                    
                    try {
                        const user = await loginUser(username, password);
                        currentUser = user;
                        updateAuthUI();
                        hideLoginModal();
                        alert('ç™»å½•æˆåŠŸï¼');
                    } catch (error) {
                        alert('ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç ');
                    }
                });
            }
        });

        // åŠ è½½è¯„è®º
        async function loadComments() {
            const speechContainer = document.getElementById('speechContainer');
            if (!speechContainer) return;
            
            try {
                const comments = await getComments();
                renderComments(comments);
            } catch (error) {
                speechContainer.innerHTML = '<div class="speech-error"><i class="fas fa-exclamation-triangle"></i> åŠ è½½è¯„è®ºå¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
            }
        }

        // æ¸²æŸ“è¯„è®º
        function renderComments(comments) {
            const speechContainer = document.getElementById('speechContainer');
            if (!speechContainer) return;
            
            speechContainer.innerHTML = '';
            
            if (comments.length === 0) {
                speechContainer.innerHTML = '<div class="no-comments">è¿˜æ²¡æœ‰æ¯•ä¸šæ„Ÿè¨€ï¼Œå¿«æ¥ç¬¬ä¸€ä¸ªå‘è¡¨å§ï¼</div>';
                return;
            }
            
            comments.forEach((comment, index) => {
                const speechItem = document.createElement('div');
                speechItem.className = 'speech-item';
                speechItem.style.animationDelay = `${index * 0.1}s`;
                
                const header = document.createElement('div');
                header.className = 'speech-header';
                
                const avatar = document.createElement('div');
                avatar.className = 'speech-avatar';
                avatar.textContent = comment.author.charAt(0);
                
                const author = document.createElement('div');
                author.className = 'speech-author';
                author.textContent = comment.author;
                
                const date = document.createElement('div');
                date.className = 'speech-date';
                date.textContent = new Date(comment.createdAt).toLocaleDateString();
                
                header.appendChild(avatar);
                header.appendChild(author);
                header.appendChild(date);
                
                const content = document.createElement('div');
                content.className = 'speech-content';
                content.textContent = comment.content;
                
                speechItem.appendChild(header);
                speechItem.appendChild(content);
                
                // æ·»åŠ åˆ é™¤æŒ‰é’®ï¼ˆç®¡ç†å‘˜æˆ–æœ¬äººï¼‰
                if (currentUser && (currentUser.get('username') === 'admin' || currentUser.get('username') === comment.author)) {
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-comment';
                    deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                    deleteBtn.title = 'åˆ é™¤è¯„è®º';
                    deleteBtn.onclick = async () => {
                        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿ')) {
                            try {
                                await deleteComment(comment.id);
                                loadComments();
                            } catch (error) {
                                console.error('åˆ é™¤è¯„è®ºå¤±è´¥:', error);
                                alert('åˆ é™¤è¯„è®ºå¤±è´¥ï¼Œè¯·é‡è¯•');
                            }
                        }
                    };
                    speechItem.appendChild(deleteBtn);
                }
                
                speechContainer.appendChild(speechItem);
            });
        }

        // æ›´æ–°ç”¨æˆ·ç•Œé¢
        function updateAuthUI() {
            const authBtn = document.getElementById('auth-btn');
            const adminLink = document.getElementById('adminLink');
            const commentForm = document.getElementById('commentForm');
            const authPrompt = document.getElementById('authPrompt');
            
            if (authBtn) {
                authBtn.textContent = currentUser ? 'é€€å‡ºç™»å½•' : 'ç™»å½•/æ³¨å†Œ';
                authBtn.href = currentUser ? 'javascript:void(0)' : 'login.html';
                
                // æ·»åŠ é€€å‡ºç™»å½•åŠŸèƒ½
                if (currentUser) {
                    authBtn.onclick = () => {
                        logoutUser();
                        currentUser = null;
                        updateAuthUI();
                        alert('å·²é€€å‡ºç™»å½•');
                    };
                } else {
                    authBtn.onclick = null;
                }
            }
            
            if (adminLink) {
                // å‡è®¾ç®¡ç†å‘˜ç”¨æˆ·åä¸º"admin"
                adminLink.style.display = currentUser && currentUser.get('username') === 'admin' ? 'block' : 'none';
            }
            
            if (commentForm && authPrompt) {
                if (currentUser) {
                    commentForm.style.display = 'block';
                    authPrompt.style.display = 'none';
                } else {
                    commentForm.style.display = 'none';
                    authPrompt.style.display = 'block';
                }
            }
        }

        // æ˜¾ç¤ºç™»å½•å¼¹çª—
        function showLoginModal() {
            const modal = document.getElementById('loginModal');
            modal.style.display = 'block';
        }

        // éšè—ç™»å½•å¼¹çª—
        function hideLoginModal() {
            const modal = document.getElementById('loginModal');
            modal.style.display = 'none';
        }

        // ç‚¹å‡»å…³é—­æŒ‰é’®
        document.querySelector('.close')?.addEventListener('click', hideLoginModal);
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.addEventListener('click', (e) => {
            const modal = document.getElementById('loginModal');
            if (e.target === modal) {
                hideLoginModal();
            }
        });
    </script>
</body>
</html>